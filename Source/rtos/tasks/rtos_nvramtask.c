/******************************************************************************
 * (C) Copyright 2020 YuChiZhiNeng-Automotive
 * FILE NAME:    rtos_nvramtask.c
 * DESCRIPTION:
 * 
 * DATE BEGUN:   
 * BY:           
 * PRODUCT NAME:
 * APPLICATION:
 * TARGET H/W:
 * DOC REF:
 *****************************************************************************
 */

/*****************************************************************************
** #include 
*****************************************************************************/
#include "bsw_init.h"

#include "rtos_taskinit.h"



/*****************************************************************************
** #define
*****************************************************************************/


/*****************************************************************************
** typedef
*****************************************************************************/


/*****************************************************************************
** global variable
*****************************************************************************/


/*****************************************************************************
** static variables
*****************************************************************************/


/*****************************************************************************
** static constants
*****************************************************************************/


/*****************************************************************************
** static function prototypes
*****************************************************************************/


/*****************************************************************************
** function prototypes
*****************************************************************************/
/****************************************************************************/
/**
 * Function Name: NVRAM_task
 * Description: none
 *
 * Param:   none
 * Return:  none
 * Author:  create this function
 ****************************************************************************/
void NVRAM_task(void)
{
	static BOOL s_b_flag = FALSE;
	static UINT8 s_u8_data[8]= {0,1,2,3,4,5,6,7};
	static UINT8 s_u8_temp[8];

	static portTickType xLastWakeTime_nvram;
	xLastWakeTime_nvram=xTaskGetTickCount();
    ApiLogPrint(_LOG_DEBUG,"This is nvram_task\n");
	RUNTASK
	{
		vTaskDelayUntil(&xLastWakeTime_nvram,100);//task周期
		Mem_EE_Handler10ms();

		if(!s_b_flag)
		{
			
			if(TRUE == Mem_EE_write(EEPID_DIAGDID_0xF186,s_u8_data))
			{
				ApiLogPrint(_LOG_DEBUG,"ee write successful!\n");
				s_b_flag = TRUE;
			}
		}

		if(s_b_flag)
		{
			if(TRUE == Mem_EE_Read(EEPID_DIAGDID_0xF186,s_u8_temp))
			{
				ApiLogPrint(_LOG_DEBUG,"ee write successful!\n");
				s_b_flag = FALSE;
			}
		}
	}
}
